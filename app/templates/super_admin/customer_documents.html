{% extends "base.html" %}

{% block title %}{{ customer.name }} - 점검서 조회{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('manage_customers') }}">고객사 관리</a></li>
                <li class="breadcrumb-item active">{{ customer.name }} - 점검서 조회</li>
            </ol>
        </nav>
        <h2><i class="bi bi-file-earmark-pdf"></i> {{ customer.name }} - 점검서 조회</h2>
        <p class="text-muted">업로드된 점검서 목록을 확인하고 조회할 수 있습니다.</p>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('manage_customers') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> 고객사 관리로 돌아가기
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header bg-light">
        <h5 class="mb-0">점검서 목록 (총 {{ documents|length }}건)</h5>
    </div>
    <div class="card-body">
        {% if documents %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>제목</th>
                        <th>설명</th>
                        <th>점검일</th>
                        <th>업로드일</th>
                        <th>업로드자</th>
                        <th>파일크기</th>
                        <th>작업</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in documents %}
                    <tr>
                        <td>{{ doc.id }}</td>
                        <td>
                            <i class="bi bi-file-earmark-pdf text-danger"></i>
                            {{ doc.title }}
                        </td>
                        <td>{{ doc.description or '-' }}</td>
                        <td>
                            {% if doc.inspection_date %}
                            {{ doc.inspection_date.strftime('%Y-%m-%d') }}
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>{{ doc.uploaded_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td>
                            {% if doc.uploader %}
                            {{ doc.uploader.name }} ({{ doc.uploader.username }})
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if doc.file_size %}
                            {{ "%.2f"|format(doc.file_size / 1024 / 1024) }} MB
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('view_document', document_id=doc.id) }}" 
                               class="btn btn-sm btn-primary" target="_blank">
                                <i class="bi bi-eye"></i> 보기
                            </a>
                            <a href="{{ url_for('serve_document', document_id=doc.id) }}" 
                               class="btn btn-sm btn-success" download>
                                <i class="bi bi-download"></i> 다운로드
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-file-earmark-x" style="font-size: 3rem; color: #ccc;"></i>
            <p class="text-muted mt-3">업로드된 점검서가 없습니다.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.breadcrumb {
    background-color: transparent;
    padding: 0;
    margin-bottom: 1rem;
}
</style>
{% endblock %}
