{% extends "base.html" %}

{% block title %}{{ customer.name }} - 점검서 조회{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{{ url_for('manage_customers') }}">고객사 관리</a></li>
                <li class="breadcrumb-item active">{{ customer.name }} - 점검서 조회</li>
            </ol>
        </nav>
        <h2><i class="bi bi-file-earmark-pdf"></i> {{ customer.name }} - 점검서 조회</h2>
        <p class="text-muted">업로드된 점검서 목록을 확인하고 조회할 수 있습니다.</p>
    </div>
    <div class="col-auto">
        <a href="{{ url_for('manage_customers') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> 고객사 관리로 돌아가기
        </a>
    </div>
</div>

<div class="card">
    <div class="card-header bg-light">
        <h5 class="mb-0">점검서 목록 (총 {{ documents|length }}건)</h5>
    </div>
    <div class="card-body">
        {% if documents %}
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>제목</th>
                        <th>점검방식</th>
                        <th>점검일</th>
                        <th>업로드일시</th>
                        <th>업로드자</th>
                        <th>파일크기</th>
                        <th>작업</th>
                    </tr>
                </thead>
                <tbody>
                    {% for doc in documents %}
                    <tr>
                        <td>{{ doc.id }}</td>
                        <td>
                            <i class="bi bi-file-earmark-pdf text-danger"></i>
                            <strong>{{ doc.title }}</strong>
                        </td>
                        <td>
                            {% if doc.inspection_type == '방문' %}
                            <span class="badge bg-primary">
                                <i class="bi bi-person-walking"></i> 방문
                            </span>
                            {% elif doc.inspection_type == '원격' %}
                            <span class="badge bg-info">
                                <i class="bi bi-laptop"></i> 원격
                            </span>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if doc.inspection_date %}
                            {{ doc.inspection_date.strftime('%Y-%m-%d') }}
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <div>{{ doc.uploaded_at.strftime('%Y-%m-%d') }}</div>
                            <small class="text-muted">{{ doc.uploaded_at.strftime('%H:%M:%S') }}</small>
                        </td>
                        <td>
                            {% if doc.uploader %}
                            <div><strong>{{ doc.uploader.name }}</strong></div>
                            <small class="text-muted">{{ doc.uploader.username }}</small>
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if doc.file_size %}
                            {{ "%.2f"|format(doc.file_size / 1024 / 1024) }} MB
                            {% else %}
                            <span class="text-muted">-</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('view_document', document_id=doc.id) }}" 
                               class="btn btn-sm btn-primary" target="_blank">
                                <i class="bi bi-eye"></i> 보기
                            </a>
                            <a href="{{ url_for('serve_document', document_id=doc.id) }}" 
                               class="btn btn-sm btn-success" download>
                                <i class="bi bi-download"></i> 다운로드
                            </a>
                            {% if current_user.is_super_admin() or current_user.is_admin() %}
                            <form method="POST" action="{{ url_for('delete_document', document_id=doc.id) }}" style="display: inline;">
                                <button type="submit" class="btn btn-sm btn-danger" 
                                        onclick="return confirm('정말로 이 점검서를 삭제하시겠습니까?')">
                                    <i class="bi bi-trash"></i> 삭제
                                </button>
                            </form>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="text-center py-5">
            <i class="bi bi-file-earmark-x" style="font-size: 3rem; color: #ccc;"></i>
            <p class="text-muted mt-3">업로드된 점검서가 없습니다.</p>
        </div>
        {% endif %}
    </div>
</div>

<style>
.breadcrumb {
    background-color: transparent;
    padding: 0;
    margin-bottom: 1rem;
}
</style>
{% endblock %}
